# Payphone API

Una API RESTful para gesti√≥n de billeteras digitales y transacciones financieras, construida con .NET 8 y siguiendo principios de Clean Architecture.

## üìã Tabla de Contenidos

- [Funcionalidad de la API](#funcionalidad-de-la-api)
- [Arquitectura](#arquitectura)
- [C√≥mo Ejecutar la API](#c√≥mo-ejecutar-la-api)
- [Documentaci√≥n de la API](#documentaci√≥n-de-la-api)
- [Endpoints Disponibles](#endpoints-disponibles)
- [Configuraci√≥n](#configuraci√≥n)
- [Tecnolog√≠as Utilizadas](#tecnolog√≠as-utilizadas)
- [Preguntas](#preguntas)

## üöÄ Funcionalidad de la API

La API de Payphone proporciona las siguientes funcionalidades principales:

### Gesti√≥n de Usuarios
- **Autenticaci√≥n**: Sistema de login con JWT tokens
- **Gesti√≥n de perfiles**: Informaci√≥n b√°sica de usuarios (nombre completo, email)

### Gesti√≥n de Billeteras
- **Creaci√≥n de billeteras**: Cada usuario puede crear billeteras digitales
- **Consulta de saldo**: Verificar el balance actual de las billeteras
- **Actualizaci√≥n de informaci√≥n**: Modificar datos de la billetera (propietario, documento)

### Transacciones Financieras
- **Dep√≥sitos**: Agregar fondos a la billetera (transacciones de cr√©dito)
- **Retiros**: Extraer fondos de la billetera (transacciones de d√©bito)
- **Historial de transacciones**: Consultar el historial completo de movimientos

### Caracter√≠sticas T√©cnicas
- **Autenticaci√≥n JWT**: Seguridad basada en tokens
- **Paginaci√≥n**: Consultas paginadas para grandes vol√∫menes de datos
- **Validaci√≥n**: Validaci√≥n robusta de datos de entrada
- **Soft Delete**: Eliminaci√≥n l√≥gica de registros
- **CORS**: Configuraci√≥n para acceso desde diferentes or√≠genes

## üèóÔ∏è Arquitectura

El proyecto sigue los principios de **Clean Architecture** con una estructura modular:

```
src/
‚îú‚îÄ‚îÄ Payphone.API/           # Capa de presentaci√≥n (Controllers, Program.cs)
‚îú‚îÄ‚îÄ Payphone.Application/   # Capa de aplicaci√≥n (Services, DTOs, Validators)
‚îú‚îÄ‚îÄ Payphone.Domain/        # Capa de dominio (Models, Enums, Core)
‚îî‚îÄ‚îÄ Payphone.Infrastructure/# Capa de infraestructura (EF Core, Repositories)
```

### Capas de la Arquitectura

#### 1. **Payphone.API** (Capa de Presentaci√≥n)
- **Controllers**: Manejo de requests HTTP
- **Program.cs**: Configuraci√≥n de la aplicaci√≥n
- **appsettings.json**: Configuraci√≥n de la aplicaci√≥n
- **Swagger**: Documentaci√≥n autom√°tica de la API

#### 2. **Payphone.Application** (Capa de Aplicaci√≥n)
- **Services**: L√≥gica de negocio
- **DTOs**: Objetos de transferencia de datos
- **Validators**: Validaci√≥n de datos de entrada
- **Mappers**: Mapeo entre entidades y DTOs

#### 3. **Payphone.Domain** (Capa de Dominio)
- **Models**: Entidades del dominio
  - `User`: Usuario del sistema
  - `Wallet`: Billetera digital
  - `WalletTransaction`: Transacciones financieras
- **Enums**: Enumeraciones del dominio
  - `TransactionType`: Tipos de transacci√≥n (Credit/Debit)
- **Core**: Modelos base y interfaces

#### 4. **Payphone.Infrastructure** (Capa de Infraestructura)
- **EF**: Entity Framework Core
  - **Persistence**: Contexto de base de datos
  - **Repositories**: Implementaci√≥n de repositorios
  - **Migrations**: Migraciones de base de datos
  - **Configurations**: Configuraci√≥n de entidades
- **Extensions**: Extensiones para configuraci√≥n de servicios

### Patrones Utilizados

- **Repository Pattern**: Abstracci√≥n del acceso a datos
- **Service Pattern**: L√≥gica de negocio encapsulada
- **DTO Pattern**: Separaci√≥n entre modelos de dominio y transferencia
- **Dependency Injection**: Inyecci√≥n de dependencias

## üöÄ C√≥mo Ejecutar la API

### Prerrequisitos

- **.NET 8.0 SDK** o superior
- **Docker** y **Docker Compose** (opcional)
- **PostgreSQL** 15 o superior

### Opci√≥n 1: Ejecuci√≥n Local

1. **Clonar el repositorio**
   ```bash
   git clone <repository-url>
   cd payphone-app
   ```

2. **Configurar la base de datos**
   - Instalar PostgreSQL
   - Crear una base de datos llamada `payphone`
   - Actualizar la cadena de conexi√≥n en `src/Payphone.API/appsettings.json`

3. **Restaurar dependencias**
   ```bash
   cd src
   dotnet restore
   ```

4. Las migraciones corren solas
  

5. **Ejecutar la aplicaci√≥n**
   ```bash
   dotnet run
   ```

La API estar√° disponible en: `https://localhost:5001`

### Opci√≥n 2: Ejecuci√≥n con Docker

1. **Clonar el repositorio**
   ```bash
   git clone <repository-url>
   cd payphone-app
   ```

2. **Ejecutar con Docker Compose**
   ```bash
   docker-compose up -d
   ```

La API estar√° disponible en: `http://localhost:5001`

### Verificar la Instalaci√≥n

- **Health Check**: `GET http://localhost:5001/health`
- **Swagger UI**: `http://localhost:5001/swagger`

## üìö Documentaci√≥n de la API

### Swagger UI

La documentaci√≥n interactiva est√° disponible en:
```
http://localhost:5001/swagger
```

### Autenticaci√≥n

La API utiliza **JWT Bearer Token** para autenticaci√≥n:

1. **Obtener token**: `POST /api/users/auth/login`
2. **Usar token**: Incluir en header: `Authorization: Bearer <token>`

### C√≥digos de Respuesta

- `200 OK`: Operaci√≥n exitosa
- `201 Created`: Recurso creado exitosamente
- `204 No Content`: Operaci√≥n exitosa sin contenido
- `400 Bad Request`: Error en datos de entrada
- `401 Unauthorized`: No autenticado
- `404 Not Found`: Recurso no encontrado
- `500 Internal Server Error`: Error interno del servidor

## üîó Endpoints Disponibles

### Autenticaci√≥n

| M√©todo | Endpoint | Descripci√≥n | Autenticaci√≥n |
|--------|----------|-------------|---------------|
| POST | `/api/users/auth/login` | Iniciar sesi√≥n | No requerida |

### Billeteras

| M√©todo | Endpoint | Descripci√≥n | Autenticaci√≥n |
|--------|----------|-------------|---------------|
| GET | `/api/wallets` | Obtener billeteras (paginated) | JWT Bearer |
| GET | `/api/wallets/{id}` | Obtener billetera por ID | JWT Bearer |
| POST | `/api/wallets` | Crear nueva billetera | JWT Bearer |
| PUT | `/api/wallets/{id}` | Actualizar billetera | JWT Bearer |
| DELETE | `/api/wallets/{id}` | Eliminar billetera (soft delete) | JWT Bearer |

### Ejemplos de Uso

#### 1. Login de Usuario
```bash
curl -X POST "http://localhost:5001/api/users/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "payphone@payphone.com",
    "password": "123@payphone"
  }'
```

#### 2. Crear Billetera
```bash
curl -X POST "http://localhost:5001/api/wallets" \
  -H "Authorization: Bearer <your-jwt-token>" \
  -H "Content-Type: application/json" \
  -d '{
    "ownerDocumentId": "12345678",
    "ownerName": "Juan P√©rez"
  }'
```

#### 3. Consultar Billeteras
```bash
curl -X GET "http://localhost:5001/api/wallets?page=1&pageSize=10" \
  -H "Authorization: Bearer <your-jwt-token>"
```

## ‚öôÔ∏è Configuraci√≥n

### Variables de Entorno

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Port=5432;Database=payphone;Username=postgres;Password=postgres"
  },
  "JwtOption": {
    "DefaultUser": "payphone@payphone.com",
    "DefaultPassword": "123@payphone",
    "Audience": "localhost.com",
    "Issuer": "localhost.com",
    "Key": "your-jwt-secret-key"
  },
  "CorsConfigOption": {
    "OriginsAllowed": "*",
    "MethodsAllowed": "*"
  }
}
```

### Configuraci√≥n de Base de Datos

- **Motor**: PostgreSQL 15
- **Migraciones**: Entity Framework Core
- **ORM**: Entity Framework Core 8.0

### Configuraci√≥n de Seguridad

- **JWT**: Autenticaci√≥n basada en tokens
- **CORS**: Configurado para desarrollo
- **HTTPS**: Redirecci√≥n autom√°tica en producci√≥n

## üõ†Ô∏è Tecnolog√≠as Utilizadas

### Backend
- **.NET 8**: Framework principal
- **ASP.NET Core**: Framework web
- **Entity Framework Core**: ORM para base de datos
- **PostgreSQL**: Base de datos relacional
- **JWT**: Autenticaci√≥n y autorizaci√≥n
- **Swagger**: Documentaci√≥n de API

### Arquitectura y Patrones
- **Clean Architecture**: Separaci√≥n de responsabilidades
- **Repository Pattern**: Abstracci√≥n de acceso a datos
- **Dependency Injection**: Inyecci√≥n de dependencias
- **DTO Pattern**: Transferencia de datos

### Herramientas de Desarrollo
- **Docker**: Containerizaci√≥n
- **Docker Compose**: Orquestaci√≥n de servicios
- **Git**: Control de versiones

## üîß Desarrollo

### Estructura de Proyectos

```
Payphone.sln
‚îú‚îÄ‚îÄ Payphone.API/           # API Web
‚îú‚îÄ‚îÄ Payphone.Application/   # L√≥gica de aplicaci√≥n
‚îú‚îÄ‚îÄ Payphone.Domain/        # Modelos de dominio
‚îî‚îÄ‚îÄ Payphone.Infrastructure/# Infraestructura
```



##  Notas Adicionales

- La API incluye un usuario por defecto para pruebas
- Las transacciones se registran con timestamps autom√°ticos
- Se implementa soft delete para preservar integridad de datos
- La documentaci√≥n se genera autom√°ticamente con Swagger
- El proyecto est√° configurado para desarrollo y producci√≥n


## Preguntas
----
# 1. ¬øC√≥mo tu implementaci√≥n puede ser escalable a miles de transacciones?

Aqui se presentan varias opciones:

### Arquitectura

- Arquitectura orientada a eventos:  Implementar Message brokers como  RabbitMQ etc, para procesar transacciones de forma as√≠ncrona.

### Base de datos

- Optimizacion de base de datos: Crear indices compuestos para mejorar el performance.
- Crear particionado logico para dividir las tablas en fechas

### Cache

- implementar un sistema de cache con redis que opere sobre todas las operaciones de la wallet y las mantega actualizada


### Microservicios
 - Crear un microservicio que gestione la wallet
 - Otro microservicio que gestione las transacciones
 - Otro para manejar los usuarios y auth.


----


# 1. ¬øC√≥mo tu implementaci√≥n asegura el principio de idempotencia?



- Implementacion de patrones como el circle breaker pattern para manejar reintentos cuando falla alguna operacion critica
- Implementar traking en las operaciones
- Bloquear registros durante operaciones criticas
- Implementar con rabbit Dead Letters Queues para mensajes que no se puedan procesar.

---


# 1. ¬øC√≥mo proteger√≠as tus servicios para evitar ataques de Denegaci√≥n de servicios, sql injection, CSRF?


 DDOS:

 - implementacion de api.gateway
 - Rate limiting por ip o usuario
 - implementar alguna CDN con proteccion DDos como cloudflare
 - implementar Load Balancers

Sql injection:

 - actualmente cubierto, como sugerencia agregarle al connection string un usuario con los privilegios necesarios


CSRF:

 - Implementar Anti-forgery Tokens
 - Cors restrictivo para origenes conocidos
 - forzar HTTPS
 - JWT con expiracion y rotacion
 - Multi-factor auth.

---


# 1. ¬øCu√°l ser√≠a tu estrategia para migrar un monolito a microservicios?


- Identificar bounded contexts y l√≠mites de dominio
- Mapear dependencias entre m√≥dulos
- Definir qu√© servicio posee qu√© datos
- Dise√±ar contratos entre servicios
- Reemplazar gradualmente funcionalidades del monolito
- Crear un API Gateway: Punto de entrada √∫nico que enruta a servicios espec√≠ficos
- Cada servicio debe tener su propia base de datos
- Comunicaci√≥n as√≠ncrona entre servicios
- Circuit Breaker: Para manejo de fallos entre servicios
- Health Checks: Para detectar servicios no saludables


----



# 1. ¬øQu√© alternativas a la soluci√≥n requerida propondr√≠as para una soluci√≥n escalable?


Alternativa 1: Arquitectura Event-Driven

Ventajas: Desacoplamiento, escalabilidad, auditor√≠a completa
Desventajas: Complejidad, consistencia eventual
Casos de Uso: Sistemas de alta concurrencia, auditor√≠a cr√≠tica


Alternativa 2: Microservicios con API Gateway
Ventajas: Independencia de equipos, escalabilidad granular
Desventajas: Complejidad operacional, latencia de red
Casos de Uso: Organizaciones grandes, dominios complejos